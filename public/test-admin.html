<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Admin Test</title>
        <link rel="stylesheet" href="styles.css" />
    </head>
    <body>
        <div style="padding: 20px; max-width: 800px; margin: 0 auto">
            <h1>Admin Dashboard Visibility Test</h1>

            <div
                style="
                    background: #f5f5f5;
                    padding: 15px;
                    border-radius: 5px;
                    margin: 20px 0;
                "
            >
                <h3>Current User Status:</h3>
                <div id="userStatus">Loading...</div>
            </div>

            <div
                style="
                    background: #e8f4fd;
                    padding: 15px;
                    border-radius: 5px;
                    margin: 20px 0;
                "
            >
                <h3>Admin Dashboard Link Tests:</h3>

                <p>
                    <strong>Test 1: Check if admin link exists in DOM</strong>
                </p>
                <div id="adminLinkExists">Checking...</div>

                <p><strong>Test 2: Check admin link visibility</strong></p>
                <div id="adminLinkVisibility">Checking...</div>

                <p><strong>Test 3: Direct admin link test</strong></p>
                <a
                    href="admin.html"
                    data-requires-admin
                    style="
                        background: rgba(255, 255, 255, 0.15);
                        color: #fbbf24;
                        padding: 8px 16px;
                        border-radius: 5px;
                        text-decoration: none;
                        display: none;
                    "
                    >üõ°Ô∏è Test Dashboard Link</a
                >
            </div>

            <div
                style="
                    background: #fff3cd;
                    padding: 15px;
                    border-radius: 5px;
                    margin: 20px 0;
                "
            >
                <h3>Navigation Links:</h3>
                <p>
                    <a href="/">Home</a> | <a href="feed.html">Feed</a> |
                    <a href="admin.html">Admin</a>
                </p>
            </div>

            <div
                style="
                    background: #d4edda;
                    padding: 15px;
                    border-radius: 5px;
                    margin: 20px 0;
                "
            >
                <h3>Login Test:</h3>
                <p>Username: admin | Password: admin</p>
                <p><a href="auth.html">Go to Login</a></p>
            </div>
        </div>

        <script>
            async function checkAdminStatus() {
                try {
                    const token = localStorage.getItem("auth_token");
                    const statusDiv = document.getElementById("userStatus");
                    const linkExistsDiv =
                        document.getElementById("adminLinkExists");
                    const linkVisibilityDiv = document.getElementById(
                        "adminLinkVisibility"
                    );

                    if (!token) {
                        statusDiv.innerHTML = "‚ùå Not logged in";
                        linkExistsDiv.innerHTML = "‚ùå No token available";
                        linkVisibilityDiv.innerHTML = "‚ùå Hidden (no login)";
                        return;
                    }

                    const res = await fetch("/api/users/me", {
                        headers: { Authorization: `Bearer ${token}` },
                    });

                    if (!res.ok) {
                        statusDiv.innerHTML = "‚ùå Invalid token";
                        linkExistsDiv.innerHTML = "‚ùå Token invalid";
                        linkVisibilityDiv.innerHTML =
                            "‚ùå Hidden (invalid token)";
                        return;
                    }

                    const data = await res.json();
                    const user = data.user;

                    statusDiv.innerHTML = `‚úÖ Logged in as: ${user.username} (Role: ${user.role})`;

                    // Check if admin links exist
                    const adminLinks = document.querySelectorAll(
                        "[data-requires-admin]"
                    );
                    linkExistsDiv.innerHTML = `‚úÖ Found ${adminLinks.length} admin link(s) in DOM`;

                    // Check visibility
                    let visibleCount = 0;
                    adminLinks.forEach((link) => {
                        const isVisible = link.style.display !== "none";
                        if (isVisible) visibleCount++;
                    });

                    if (user.role === "admin") {
                        linkVisibilityDiv.innerHTML = `‚úÖ Admin role detected - ${visibleCount}/${adminLinks.length} links visible`;
                    } else {
                        linkVisibilityDiv.innerHTML = `‚ö†Ô∏è Regular user - ${visibleCount}/${adminLinks.length} links visible (should be 0)`;
                    }
                } catch (error) {
                    document.getElementById("userStatus").innerHTML =
                        "‚ùå Error: " + error.message;
                    document.getElementById("adminLinkExists").innerHTML =
                        "‚ùå Error checking links";
                    document.getElementById("adminLinkVisibility").innerHTML =
                        "‚ùå Error checking visibility";
                }
            }

            // Run the check when page loads
            document.addEventListener("DOMContentLoaded", checkAdminStatus);
        </script>

        <script src="script.js"></script>
    </body>
</html>
